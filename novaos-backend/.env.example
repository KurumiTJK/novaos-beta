# ═══════════════════════════════════════════════════════════════════════════════
# NovaOS Backend — Environment Variables
# ═══════════════════════════════════════════════════════════════════════════════
# 
# Copy this file to .env and fill in your values:
#   cp .env.example .env
#
# ⚠️  NEVER commit .env to version control
# ⚠️  All values below are EXAMPLES — replace with your actual keys
#
# ═══════════════════════════════════════════════════════════════════════════════

# ─────────────────────────────────────────────────────────────────────────────────
# SERVER CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────────

PORT=3000
NODE_ENV=development
# NODE_ENV options: development | staging | production

# Trust proxy (set to true if behind nginx/cloudflare)
TRUST_PROXY=false

# Graceful shutdown timeout (ms)
SHUTDOWN_TIMEOUT_MS=10000

# ─────────────────────────────────────────────────────────────────────────────────
# CORS CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────────

# Comma-separated list of allowed origins (production only)
# Leave empty to allow all in development
CORS_ORIGINS=https://nova.yourdomain.com,https://app.yourdomain.com

# Allow credentials (cookies, auth headers)
CORS_ALLOW_CREDENTIALS=true

# ─────────────────────────────────────────────────────────────────────────────────
# AUTHENTICATION / JWT
# ─────────────────────────────────────────────────────────────────────────────────

# ⚠️  CRITICAL: Change this in production! Minimum 32 characters
JWT_SECRET=your-256-bit-secret-minimum-32-characters-here

# Token issuer and audience (for validation)
JWT_ISSUER=novaos
JWT_AUDIENCE=novaos-api

# Token expiration times
JWT_ACCESS_EXPIRY=15m
JWT_REFRESH_EXPIRY=7d
JWT_API_KEY_EXPIRY=365d

# Require authentication for chat endpoint
AUTH_REQUIRED=false

# ─────────────────────────────────────────────────────────────────────────────────
# LLM PROVIDERS
# ─────────────────────────────────────────────────────────────────────────────────

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ OPENAI — Primary LLM provider                                               │
# │ Get your key: https://platform.openai.com/api-keys                         │
# └─────────────────────────────────────────────────────────────────────────────┘

OPENAI_API_KEY=sk-proj-your-openai-api-key-here

# Model for 8-gate pipeline classification (fast, cheap)
OPENAI_MODEL_PIPELINE=gpt-4o-mini

# Model for response generation (quality)
OPENAI_MODEL_GENERATION=gpt-4o

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ GOOGLE GEMINI — Used for grounded/live data responses                      │
# │ Get your key: https://aistudio.google.com/app/apikey                       │
# └─────────────────────────────────────────────────────────────────────────────┘

GEMINI_API_KEY=your-gemini-api-key-here

# Gemini model for grounded responses
GEMINI_MODEL=gemini-2.0-flash

# ─────────────────────────────────────────────────────────────────────────────────
# SWORDGATE LLM CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────────
# SwordGate uses Gemini for lesson design and exploration

# Model for SwordGate operations
SWORDGATE_LLM_MODEL=gemini-2.5-pro-preview-05-06

# Thinking level: low | high
# - low:  Faster responses, less reasoning depth
# - high: Slower but more carefully reasoned (recommended)
SWORDGATE_LLM_THINKING_LEVEL=high

# ─────────────────────────────────────────────────────────────────────────────────
# REDIS — Session & Cache Storage (Upstash recommended)
# ─────────────────────────────────────────────────────────────────────────────────
# 
# Get free Redis: https://upstash.com
# 
# Format: rediss://default:PASSWORD@HOST:PORT
# Note: Use rediss:// (with double s) for TLS connections
#

REDIS_URL=rediss://default:your-upstash-redis-password@your-region.upstash.io:6379

# ─────────────────────────────────────────────────────────────────────────────────
# SUPABASE — PostgreSQL Database
# ─────────────────────────────────────────────────────────────────────────────────
#
# Get free database: https://supabase.com
# Find these in: Dashboard → Settings → API
#

# Project URL (ends with .supabase.co)
SUPABASE_URL=https://your-project-id.supabase.co

# Service Role Key (NOT the anon key!)
# ⚠️  Keep this secret — it bypasses Row Level Security
SUPABASE_SERVICE_KEY=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.your-service-key-here

# ─────────────────────────────────────────────────────────────────────────────────
# GOOGLE APIS — For Lesson Resources (Articles & Videos)
# ─────────────────────────────────────────────────────────────────────────────────
#
# Setup:
# 1. Go to: https://console.cloud.google.com/apis/credentials
# 2. Create API Key
# 3. Enable these APIs:
#    - Custom Search API
#    - YouTube Data API v3
#

# Google API Key (for both Custom Search and YouTube)
GOOGLE_API_KEY=your-google-api-key-here

# Alternative: Separate keys for each service
GOOGLE_CSE_API_KEY=your-google-cse-api-key-here
YOUTUBE_API_KEY=your-youtube-api-key-here

# ┌─────────────────────────────────────────────────────────────────────────────┐
# │ Programmable Search Engine ID                                               │
# │ Create at: https://programmablesearchengine.google.com/                    │
# │ Configure to search the entire web                                          │
# └─────────────────────────────────────────────────────────────────────────────┘

GOOGLE_SEARCH_ENGINE_ID=your-search-engine-id-here
# Also accepted as:
GOOGLE_CSE_ID=your-search-engine-id-here

# ─────────────────────────────────────────────────────────────────────────────────
# n8n INTEGRATION (Optional — for Modules & Actions)
# ─────────────────────────────────────────────────────────────────────────────────

# n8n webhook base URL (if self-hosting n8n)
N8N_WEBHOOK_BASE_URL=http://localhost:5678/webhook

# HMAC secret for signing n8n webhook requests
# Generate with: openssl rand -hex 32
N8N_HMAC_SECRET=your-hmac-secret-for-n8n-webhooks

# ─────────────────────────────────────────────────────────────────────────────────
# SECURITY CONFIGURATION
# ─────────────────────────────────────────────────────────────────────────────────

# Brute force protection
BRUTE_FORCE_MAX_ATTEMPTS=5
BRUTE_FORCE_LOCKOUT_MINUTES=15

# Rate limiting (requests per minute by category)
RATE_LIMIT_AUTH=10
RATE_LIMIT_CHAT=20
RATE_LIMIT_API=100

# ─────────────────────────────────────────────────────────────────────────────────
# OBSERVABILITY (Optional)
# ─────────────────────────────────────────────────────────────────────────────────

# Sentry error tracking
# Get DSN from: https://sentry.io
SENTRY_DSN=https://your-key@your-org.ingest.sentry.io/your-project-id

# Debug mode (verbose logging)
DEBUG_MODE=false

# Redact PII in logs
REDACT_PII=true

# ─────────────────────────────────────────────────────────────────────────────────
# DEBUG FLAGS (Development Only)
# ─────────────────────────────────────────────────────────────────────────────────
# Set to true to see detailed gate outputs

DEBUG_INTENT_GATE=false
DEBUG_SHIELD_GATE=false
DEBUG_RESPONSE_GATE=false
DEBUG_CONSTITUTION_GATE=false
DEBUG_CAPABILITY_GATE=false

# ─────────────────────────────────────────────────────────────────────────────────
# FEATURE FLAGS
# ─────────────────────────────────────────────────────────────────────────────────

# Enable/disable verification system
VERIFICATION_ENABLED=true
VERIFICATION_REQUIRED=false

# Enable/disable web fetch capability
WEB_FETCH_ENABLED=true
WEB_FETCH_MAX_SIZE_BYTES=1048576
WEB_FETCH_TIMEOUT_MS=10000

# ═══════════════════════════════════════════════════════════════════════════════
# QUICK START CHECKLIST
# ═══════════════════════════════════════════════════════════════════════════════
#
# Minimum required for development:
# ✅ OPENAI_API_KEY
# ✅ JWT_SECRET (change from default!)
#
# For full functionality:
# ✅ GEMINI_API_KEY (grounded responses)
# ✅ REDIS_URL (session persistence)
# ✅ SUPABASE_URL + SUPABASE_SERVICE_KEY (database)
# ✅ GOOGLE_API_KEY + GOOGLE_SEARCH_ENGINE_ID (lesson resources)
#
# ═══════════════════════════════════════════════════════════════════════════════
